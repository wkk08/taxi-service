name: Manual Deploy to Kubernetes

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'éƒ¨ç½²ç¯å¢ƒ'
        required: true
        default: 'staging'
        type: choice
        options:
        - staging
        - production
      image_tag:
        description: 'é•œåƒæ ‡ç­¾ (é»˜è®¤: latest)'
        required: false
        default: 'latest'
        type: string

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up kubectl
      uses: azure/setup-kubectl@v3
      with:
        version: 'latest'
    
    - name: Deploy to Kubernetes
      run: |
        echo "ğŸš€ éƒ¨ç½²åˆ° ${{ github.event.inputs.environment }} ç¯å¢ƒ"
        echo "ä½¿ç”¨é•œåƒæ ‡ç­¾: ${{ github.event.inputs.image_tag }}"
        
        # æ›´æ–°deployment.yamlä¸­çš„é•œåƒæ ‡ç­¾
        if [ -f kubernetes/deployment.yaml ]; then
          sed -i "s|image: .*|image: ghcr.io/${{ github.repository }}:${{ github.event.inputs.image_tag }}|" kubernetes/deployment.yaml
          kubectl apply -f kubernetes/deployment.yaml
          echo "âœ… éƒ¨ç½²å®Œæˆ"
        else
          echo "âš ï¸ æ‰¾ä¸åˆ°Kuberneteséƒ¨ç½²æ–‡ä»¶"
        fi